COPY scripts/ci/apt-install /bin/apt-install

RUN apt-get clean -y && apt-get update -y && apt-get install -y gnupg2 --no-install-recommends

# Add the cross compiler sources
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 871920D1991BC93C 8D69674688B6CB36 B523E5F3FC4E5F2C

# RUN echo "deb [arch=amd64,riscv64] http://deb.debian.org/debian stable main" >> /etc/apt/sources.list && \
# 	echo "deb [arch=amd64,riscv64] http://deb.debian.org/debian-ports sid main" >> /etc/apt/sources.list && \
# 	dpkg --add-architecture ${DEBIAN_ARCH}

COPY scripts/ci/amd64-sources.list /etc/apt/sources.list

COPY scripts/ci/riscv64-sources.list /etc/apt/sources.list.d/

RUN cat /etc/apt/sources.list && \
	cat /etc/apt/sources.list.d/riscv64-sources.list && \
	dpkg --add-architecture ${DEBIAN_ARCH} && \
	apt-get clean -y && \
	apt-get update -y

RUN apt-cache policy libbz2-1.0:riscv64 libbz2-dev:riscv64 && \
	cat /var/lib/dpkg/arch

RUN apt-get install -y --no-install-recommends \
	crossbuild-essential-${DEBIAN_ARCH}	\
	libc6-dev-${DEBIAN_ARCH}-cross		\
	libc6-${DEBIAN_ARCH}-cross		\
	libbz2-dev:${DEBIAN_ARCH}		\
	libexpat1-dev:${DEBIAN_ARCH}		\
	ncurses-dev:${DEBIAN_ARCH}		\
	libssl-dev:${DEBIAN_ARCH}		\
	protobuf-c-compiler			\
	protobuf-compiler			\
	python3-protobuf			\
	libnl-3-dev:${DEBIAN_ARCH}		\
	libprotobuf-dev:${DEBIAN_ARCH}		\
	libnet-dev:${DEBIAN_ARCH}		\
	libprotobuf-c-dev:${DEBIAN_ARCH}	\
	libcap-dev:${DEBIAN_ARCH}		\
	libaio-dev:${DEBIAN_ARCH}		\
	libnl-route-3-dev:${DEBIAN_ARCH}

# gcc-riscv64-linux-gnu:native \
# g++-riscv64-linux-gnu:native \
# dpkg-cross:native \

RUN ls /usr/bin/*riscv*

# ENV CROSS_COMPILE=${CROSS_TRIPLET}-				\
# 	CROSS_ROOT=/usr/${CROSS_TRIPLET}			\
# 	AS=/usr/bin/${CROSS_TRIPLET}-as				\
# 	AR=/usr/bin/${CROSS_TRIPLET}-ar				\
# 	CC=/usr/bin/${CROSS_TRIPLET}-gcc			\
# 	CPP=/usr/bin/${CROSS_TRIPLET}-cpp			\
# 	CXX=/usr/bin/${CROSS_TRIPLET}-g++			\
# 	LD=/usr/bin/${CROSS_TRIPLET}-ld				\
# 	FC=/usr/bin/${CROSS_TRIPLET}-gfortran

# ENV PATH="${PATH}:${CROSS_ROOT}/bin"				\
# 	PKG_CONFIG_PATH=/usr/lib/${CROSS_TRIPLET}/pkgconfig

# COPY . /criu
# WORKDIR /criu

# RUN	make mrproper && date && make -j $(nproc) zdtm && date
